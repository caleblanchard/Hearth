# Nginx Reverse Proxy Configuration

This directory contains the Nginx configuration files for the reverse proxy setup.

## Directory Structure

```
nginx/
├── nginx.conf          # Main Nginx configuration
├── conf.d/
│   └── hearth.conf     # Hearth application server block
├── certs/              # SSL certificates (auto-generated)
└── logs/               # Nginx access and error logs
```

## Files

### nginx.conf
Main Nginx configuration file with:
- Worker processes and connections
- Logging format
- Gzip compression
- Security headers
- Rate limiting zones

### conf.d/hearth.conf
Server block configuration for `hearth.blanchardsd.com`:
- HTTP to HTTPS redirect
- Let's Encrypt challenge handling
- HTTPS server configuration
- SSL/TLS settings
- Proxy configuration to Hearth app
- Rate limiting for API endpoints

## SSL Certificates

Certificates are automatically generated by Certbot and stored in:
- `/etc/letsencrypt/live/hearth.blanchardsd.com/` (Certbot volume)
- `/etc/nginx/certs/` (Nginx accessible location)

Certificates are automatically renewed via cron job in the Certbot container.

## Customization

### Change Domain
1. Update `nginx/conf.d/hearth.conf`:
   - Replace `hearth.blanchardsd.com` with your domain
2. Update `docker-compose.nginx.yml`:
   - Replace `hearth.blanchardsd.com` in Certbot commands
3. Update email in `docker-compose.nginx.yml`:
   - Change `admin@blanchardsd.com` to your email

### Adjust Rate Limits
Edit `nginx/nginx.conf`:
```nginx
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=5r/s;
```

### Change App Container Name
If your Hearth app container has a different name, update `nginx/conf.d/hearth.conf`:
```nginx
proxy_pass http://your-container-name:3000;
```

## Troubleshooting

### View Logs
```bash
docker logs nginx-reverse-proxy
tail -f nginx/logs/access.log
tail -f nginx/logs/error.log
```

### Test Configuration
```bash
docker exec nginx-reverse-proxy nginx -t
```

### Reload Configuration
```bash
docker exec nginx-reverse-proxy nginx -s reload
```

### Check Certificates
```bash
docker exec certbot certbot certificates
ls -la nginx/certs/
```
